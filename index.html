<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>X/Twitter & Multi-Platform Media Downloader</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --primary: #6366f1;
      --primary-hover: #4f46e5;
      --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
      --glass-bg: rgba(255, 255, 255, 0.05);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text-main: #f8fafc;
      --text-muted: #94a3b8;
      --accent: #22d3ee;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--bg-gradient);
      background-attachment: fixed;
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
      line-height: 1.6;
    }

    .container {
      width: 100%;
      max-width: 1000px;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: 800;
      background: linear-gradient(to right, #fff, var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }

    .description {
      color: var(--text-muted);
      font-size: 1.1rem;
    }

    .card {
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 24px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
      border-color: rgba(255, 255, 255, 0.2);
    }

    .section-title {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--accent);
      margin-bottom: 16px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    textarea {
      width: 100%;
      min-height: 160px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      color: #e2e8f0;
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
      padding: 16px;
      resize: vertical;
      transition: all 0.2s;
    }

    textarea:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(0, 0, 0, 0.3);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }

    .options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fR));
      gap: 20px;
      margin-top: 24px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .input-group label {
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-muted);
    }

    input[type="text"] {
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 10px 14px;
      color: white;
      font-family: inherit;
      transition: all 0.2s;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--primary);
    }

    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-top: 10px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      user-select: none;
    }

    .checkbox-item input {
      accent-color: var(--primary);
      width: 16px;
      height: 16px;
    }

    .actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      align-items: center;
    }

    button {
      padding: 12px 24px;
      border-radius: 10px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    #convertBtn {
      background: var(--primary);
      color: white;
    }

    #convertBtn:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
    }

    #copyBtn {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid var(--glass-border);
    }

    #copyBtn:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    #status {
      font-size: 0.85rem;
      color: var(--accent);
      margin-left: auto;
    }

    #output {
      min-height: 120px;
      background: rgba(0, 0, 0, 0.4);
      color: #9cdcfe;
    }

    .footer {
      text-align: center;
      margin-top: auto;
      padding: 40px 0;
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .footer a {
      color: var(--accent);
      text-decoration: none;
    }

    @media (max-width: 640px) {
      h1 {
        font-size: 1.8rem;
      }

      .card {
        padding: 20px;
      }

      .actions {
        flex-direction: column;
        align-items: stretch;
      }

      #status {
        margin-left: 0;
        text-align: center;
        margin-top: 10px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>Video & Audio Downloader Helper</h1>
      <p class="description">Convert cURL commands to download scripts for X (Twitter) and other video/audio
        platforms</p>
    </header>

    <div class="card">
      <div class="section-title">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
          <polyline points="7 10 12 15 17 10" />
          <line x1="12" y1="15" x2="12" y2="3" />
        </svg>
        Input cURL
      </div>
      <textarea id="curlInput" placeholder="Paste your curl command from the Network tab here..."></textarea>

      <div class="options-grid">
        <div class="input-group">
          <label>Save Directory</label>
          <input id="saveDir" type="text" value="./downloads" />
        </div>
        <div class="input-group">
          <label>File Name</label>
          <input id="saveName" type="text" value="podcast" />
        </div>
        <div class="input-group">
          <label>Threads</label>
          <input id="threads" type="text" value="16" />
        </div>
        <div class="input-group">
          <label>Retry Count</label>
          <input id="retry" type="text" value="3" />
        </div>
      </div>

      <div class="checkbox-group">
        <label class="checkbox-item">
          <input id="autoSelect" type="checkbox" checked /> --auto-select
        </label>
        <label class="checkbox-item">
          <input id="selectAudioBest" type="checkbox" checked /> --select-audio best
        </label>
        <label class="checkbox-item">
          <input id="noLog" type="checkbox" checked /> --no-log
        </label>
        <label class="checkbox-item">
          <input id="delAfter" type="checkbox" checked /> --del-after-done
        </label>
      </div>

      <div class="actions">
        <button id="convertBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
            stroke-linecap="round" stroke-linejoin="round">
            <polyline points="16 3 21 3 21 8" />
            <line x1="4" y1="20" x2="21" y2="3" />
            <polyline points="21 16 21 21 16 21" />
            <line x1="15" y1="15" x2="21" y2="21" />
            <line x1="4" y1="4" x2="9" y2="9" />
          </svg>
          Convert
        </button>
        <button id="copyBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
          </svg>
          Copy Result
        </button>
        <span id="status"></span>
      </div>
    </div>

    <div class="card">
      <div class="section-title">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <polyline points="4 17 10 11 4 5" />
          <line x1="12" y1="19" x2="20" y2="19" />
        </svg>
        Output N_m3u8DL-RE Command
      </div>
      <textarea id="output" readonly placeholder="The generated command will appear here..."></textarea>
    </div>

    <footer class="footer">
      Created by <a href="mailto:vu@witi.vn">Tien Vu (witi.vn)</a> &bull;
      Requires: <a href="https://github.com/nilaoda/N_m3u8DL-RE" target="_blank">N_m3u8DL-RE CLI</a>
    </footer>
  </div>

  <script>
    function normalizeCurl(text) {
      let t = text.replace(/\r/g, "");
      t = t.replace(/\\\n\s*/g, " ");
      return t.trim();
    }

    function extractUrl(curlText) {
      const m = curlText.match(/\bcurl\b\s+(?:--compressed\s+)?(['"])(https?:\/\/.+?)\1/i);
      if (m && m[2]) return m[2];
      const m2 = curlText.match(/(['"])(https?:\/\/.+?)\1/);
      if (m2 && m2[2]) return m2[2];
      const m3 = curlText.match(/\bhttps?:\/\/\S+/);
      return m3 ? m3[0] : "";
    }

    function extractHeaders(curlText) {
      const headers = [];
      const re = /(?:\s|^)-H\s+(['"])(.*?)\1/g;
      let m;
      while ((m = re.exec(curlText)) !== null) {
        const raw = m[2].trim();
        if (!raw) continue;
        headers.push(raw.replace(/\n+/g, " "));
      }
      return headers;
    }

    function escapeForDoubleQuotes(s) {
      return s.replace(/\\/g, "\\\\").replace(/"/g, '\\"');
    }

    function buildCommand(url, headers, opts) {
      if (!url) return "";
      const parts = [];
      parts.push(`./N_m3u8DL-RE "${url}"`);
      if (opts.saveDir) parts.push(`  --save-dir "${opts.saveDir}"`);
      if (opts.saveName) parts.push(`  --save-name "${opts.saveName}"`);
      if (opts.autoSelect) parts.push(`  --auto-select`);
      if (opts.selectAudioBest) parts.push(`  --select-audio best`);
      if (opts.noLog) parts.push(`  --no-log`);
      headers.forEach(h => {
        parts.push(`  --header "${escapeForDoubleQuotes(h)}"`);
      });
      if (opts.threads) parts.push(`  --thread-count ${opts.threads}`);
      if (opts.retry) parts.push(`  --download-retry-count ${opts.retry}`);
      if (opts.delAfter) parts.push(`  --del-after-done`);
      return parts.map((p, i) => i === 0 ? p + " \\" : p + (i === parts.length - 1 ? "" : " \\")).join("\n");
    }

    function convert() {
      const input = document.getElementById("curlInput").value;
      if (!input.trim()) {
        document.getElementById("output").value = "";
        document.getElementById("status").textContent = "";
        return;
      }
      const normalized = normalizeCurl(input);
      const url = extractUrl(normalized);
      const headers = extractHeaders(normalized);
      const opts = {
        saveDir: document.getElementById("saveDir").value.trim(),
        saveName: document.getElementById("saveName").value.trim(),
        autoSelect: document.getElementById("autoSelect").checked,
        selectAudioBest: document.getElementById("selectAudioBest").checked,
        noLog: document.getElementById("noLog").checked,
        threads: document.getElementById("threads").value.trim(),
        retry: document.getElementById("retry").value.trim(),
        delAfter: document.getElementById("delAfter").checked
      };
      const out = buildCommand(url, headers, opts);
      document.getElementById("output").value = out || "Valid URL not found in cURL command.";
      document.getElementById("status").textContent =
        url ? `✨ URL found + ${headers.length} headers` : "❌ URL not found";
    }

    async function copyOutput() {
      const out = document.getElementById("output").value;
      if (!out) return;
      try {
        await navigator.clipboard.writeText(out);
        const originalText = document.getElementById("status").textContent;
        document.getElementById("status").textContent = "✅ Copied to clipboard!";
        setTimeout(() => {
          document.getElementById("status").textContent = originalText;
        }, 2000);
      } catch (e) {
        alert("Unable to copy automatically, please copy manually.");
      }
    }

    document.getElementById("convertBtn").addEventListener("click", convert);
    document.getElementById("copyBtn").addEventListener("click", copyOutput);
    document.getElementById("curlInput").addEventListener("paste", () => {
      setTimeout(convert, 50);
    });
    // Auto convert on input change too
    document.querySelectorAll('input').forEach(el => {
      el.addEventListener('input', convert);
    });
  </script>
</body>

</html>